
<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>search-api: Relevancy - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/apps/search-api/relevancy.html">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta name="twitter:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="search-api: Relevancy - GOV.UK Developer Documentation" />
      <meta name="twitter:url" content="https://docs.publishing.service.gov.uk/apps/search-api/relevancy.html" />

      <meta property="og:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="search-api: Relevancy" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/apps/search-api/relevancy.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/apps.html">Apps</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents" role="dialog">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search" aria-hidden="true">
      Search (via Google)
    </label>
    <input
      type="text"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="assertive" role="alert">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <ul>
    <li>
      <a href="/apps/govuk-account-manager-prototype.html"><span>govuk-account-manager-prototype</span></a>
    </li>
    <li>
      <a href="/apps/govuk-attribute-service-prototype.html"><span>govuk-attribute-service-prototype</span></a>
    </li>
    <li>
      <a href="/apps/collections-publisher.html"><span>collections-publisher</span></a>
        <ul>
            <li><a href="/apps/collections-publisher/coronavirus_page_publishing_tool.html"><span># Coronavirus Publishing Tool</span></a></li>
            <li><a href="/apps/collections-publisher/reslugging-a-tag.html"><span>Changing the slug of a Tag or Topic</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/contacts-admin.html"><span>contacts-admin</span></a>
        <ul>
            <li><a href="/apps/contacts-admin/redirects.html"><span>Redirecting contacts that have been removed already</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/content-tagger.html"><span>content-tagger</span></a>
        <ul>
        </ul>
    </li>
    <li>
      <a href="/apps/content-publisher.html"><span>content-publisher</span></a>
        <ul>
            <li><a href="/apps/content-publisher/approach-to-analytics.html"><span>Approach to Analytics</span></a></li>
            <li><a href="/apps/content-publisher/edit-change-note-history.html"><span>Editing a document's change history</span></a></li>
            <li><a href="/apps/content-publisher/history-mode.html"><span>History mode</span></a></li>
            <li><a href="/apps/content-publisher/import-from-whitehall.html"><span>Importing documents from Whitehall to Content Publisher</span></a></li>
            <li><a href="/apps/content-publisher/removing-documents.html"><span>Removing or removing and redirecting a document</span></a></li>
            <li><a href="/apps/content-publisher/scheduled-publishing.html"><span>Scheduled publishing</span></a></li>
            <li><a href="/apps/content-publisher/testing-strategy.html"><span>Testing Strategy</span></a></li>
            <li><a href="/apps/content-publisher/user-permissions.html"><span>User Permissions</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/local-links-manager.html"><span>local-links-manager</span></a>
        <ul>
            <li><a href="/apps/local-links-manager/checking-links.html"><span>Checking Links</span></a></li>
            <li><a href="/apps/local-links-manager/deleting-a-link.html"><span>Deleting a local transaction link</span></a></li>
            <li><a href="/apps/local-links-manager/enable-or-create-service.html"><span>Enabling (or creating) a new service</span></a></li>
            <li><a href="/apps/local-links-manager/example-api-output.html"><span># Example API output</span></a></li>
            <li><a href="/apps/local-links-manager/exporting-local-authority-links.html"><span>Exporting Local Authority links to services</span></a></li>
            <li><a href="/apps/local-links-manager/google_analytics_custom_import.html"><span>Authorisation for Google Analytics custom import</span></a></li>
            <li><a href="/apps/local-links-manager/importing-local-authorities-data.html"><span>Importing Local Authorities data</span></a></li>
            <li><a href="/apps/local-links-manager/importing-service-links-from-csv.html"><span>Importing Service Links from a CSV</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/manuals-publisher.html"><span>manuals-publisher</span></a>
        <ul>
            <li><a href="/apps/manuals-publisher/current-state.html"><span>Current state</span></a></li>
            <li><a href="/apps/manuals-publisher/fully-migrated-spike.html"><span>Fully-migrated spike</span></a></li>
            <li><a href="/apps/manuals-publisher/history.html"><span>History</span></a></li>
            <li><a href="/apps/manuals-publisher/next-steps.html"><span>Next steps</span></a></li>
            <li><a href="/apps/manuals-publisher/rake-tasks.html"><span>Rake tasks</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/maslow.html"><span>maslow</span></a>
    </li>
    <li>
      <a href="/apps/publisher.html"><span>publisher</span></a>
        <ul>
            <li><a href="/apps/publisher/fact-checking.html"><span>Fact Checking</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/service-manual-publisher.html"><span>service-manual-publisher</span></a>
        <ul>
        </ul>
    </li>
    <li>
      <a href="/apps/short-url-manager.html"><span>short-url-manager</span></a>
    </li>
    <li>
      <a href="/apps/specialist-publisher.html"><span>specialist-publisher</span></a>
        <ul>
            <li><a href="/apps/specialist-publisher/acceptance-testing.html"><span># Acceptance Testing</span></a></li>
            <li><a href="/apps/specialist-publisher/creating-a-new-specialist-document-type.html"><span>Creating a new specialist document format</span></a></li>
            <li><a href="/apps/specialist-publisher/email-alerts.html"><span># Email Alerts</span></a></li>
            <li><a href="/apps/specialist-publisher/tasks.html"><span>Rake tasks</span></a></li>
            <li><a href="/apps/specialist-publisher/updating-existing-organisation-data.html"><span>Updating existing organisation data</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/travel-advice-publisher.html"><span>travel-advice-publisher</span></a>
        <ul>
            <li><a href="/apps/travel-advice-publisher/error-monitoring-for-travel-advice-alerts.html"><span>Error Monitoring for Travel Advice Alerts</span></a></li>
            <li><a href="/apps/travel-advice-publisher/further-technical-information.html"><span># Further technical information</span></a></li>
            <li><a href="/apps/travel-advice-publisher/publish_and_notification_workflow.html"><span>Publish and Notification Workflow</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/whitehall.html"><span>whitehall</span></a>
        <ul>
            <li><a href="/apps/whitehall/api.html"><span>Whitehall API</span></a></li>
            <li><a href="/apps/whitehall/css.html"><span>Whitehall CSS Styleguide</span></a></li>
            <li><a href="/apps/whitehall/edition_workflow.html"><span>Edition Workflow</span></a></li>
            <li><a href="/apps/whitehall/finders.html"><span>Finders</span></a></li>
            <li><a href="/apps/whitehall/internationalisation_guide.html"><span>Internationalisation guide</span></a></li>
            <li><a href="/apps/whitehall/javascript.html"><span>Whitehall JavaScript</span></a></li>
            <li><a href="/apps/whitehall/link_checker_api_integration.html"><span>Link Checker API Integrations</span></a></li>
            <li><a href="/apps/whitehall/search_setup_guide.html"><span>Search setup guide</span></a></li>
            <li><a href="/apps/whitehall/testing_guide.html"><span>Testing Guide</span></a></li>
            <li><a href="/apps/whitehall/timestamps.html"><span>Timestamps</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/account-api.html"><span>account-api</span></a>
        <ul>
            <li><a href="/apps/account-api/api.html"><span>API documentation</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/content-store.html"><span>content-store</span></a>
        <ul>
            <li><a href="/apps/content-store/access-limited-content-items.html"><span>Access-limited content items</span></a></li>
            <li><a href="/apps/content-store/content-store-api.html"><span>Content Store API</span></a></li>
            <li><a href="/apps/content-store/content_item_fields.html"><span>Content Item Fields</span></a></li>
            <li><a href="/apps/content-store/gone_item.html"><span># Gone items</span></a></li>
            <li><a href="/apps/content-store/placeholder_item.html"><span># Placeholder items</span></a></li>
            <li><a href="/apps/content-store/publish_intents.html"><span>Publish intents</span></a></li>
            <li><a href="/apps/content-store/redirect_item.html"><span># Redirect items</span></a></li>
            <li><a href="/apps/content-store/route_registration.html"><span># Registering routes with the router.</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/email-alert-api.html"><span>email-alert-api</span></a>
        <ul>
            <li><a href="/apps/email-alert-api/analytics.html"><span>Analytics</span></a></li>
            <li><a href="/apps/email-alert-api/api.html"><span>Available endpoints</span></a></li>
            <li><a href="/apps/email-alert-api/data-cleanup-mechanisms.html"><span>Data cleanup mechanisms</span></a></li>
            <li><a href="/apps/email-alert-api/env-vars.html"><span>ENV vars</span></a></li>
            <li><a href="/apps/email-alert-api/matching-content-to-subscriber-lists.html"><span>Matching content to subscriber lists</span></a></li>
            <li><a href="/apps/email-alert-api/support-tasks.html"><span>Support tasks</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/imminence.html"><span>imminence</span></a>
    </li>
    <li>
      <a href="/apps/link-checker-api.html"><span>link-checker-api</span></a>
        <ul>
            <li><a href="/apps/link-checker-api/api.html"><span>Link Checker API's API</span></a></li>
            <li><a href="/apps/link-checker-api/blitz.html"><span>End of blitz summary - April 2017</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/publishing-api.html"><span>publishing-api</span></a>
        <ul>
            <li><a href="/apps/publishing-api/admin-tasks.html"><span>Admin Tasks</span></a></li>
            <li><a href="/apps/publishing-api/api.html"><span>Publishing API's API</span></a></li>
            <li><a href="/apps/publishing-api/data-migration.html"><span>Writing data migrations</span></a></li>
            <li><a href="/apps/publishing-api/deleting-content.html"><span>Deleting Documents, Editions and Links</span></a></li>
            <li><a href="/apps/publishing-api/dependency-resolution.html"><span>Dependency Resolution</span></a></li>
            <li><a href="/apps/publishing-api/link-expansion.html"><span>Link Expansion</span></a></li>
            <li><a href="/apps/publishing-api/model.html"><span>Publishing API's Model</span></a></li>
            <li><a href="/apps/publishing-api/pact_testing.html"><span>Contract testing with Pact</span></a></li>
            <li><a href="/apps/publishing-api/publishing-application-examples.html"><span>Publishing application examples</span></a></li>
            <li><a href="/apps/publishing-api/rabbitmq.html"><span>RabbitMQ</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/search-api.html"><span>search-api</span></a>
        <ul>
            <li><a href="/apps/search-api/adding-new-fields.html"><span>Adding new fields to a document type</span></a></li>
            <li><a href="/apps/search-api/content-api.html"><span>Content API</span></a></li>
            <li><a href="/apps/search-api/content_overview.html"><span>Content in the search index and where it comes from</span></a></li>
            <li><a href="/apps/search-api/documents.html"><span>Documents API (to be deprecated)</span></a></li>
            <li><a href="/apps/search-api/how-search-works.html"><span>How Search Works</span></a></li>
            <li><a href="/apps/search-api/indexing.html"><span>Indexing</span></a></li>
            <li><a href="/apps/search-api/learning-to-rank.html"><span>learning-to-rank</span></a></li>
            <li><a href="/apps/search-api/new-indexing-process.html"><span>Moving a format to the new indexing process</span></a></li>
            <li><a href="/apps/search-api/popularity.html"><span>Popularity information</span></a></li>
            <li><a href="/apps/search-api/publishing-finders.html"><span>Publishing finders</span></a></li>
            <li><a href="/apps/search-api/relevancy.html" class="toc-link--in-view"><span>Relevancy</span></a></li>
            <li><a href="/apps/search-api/schemas.html"><span>Schema definitions</span></a></li>
            <li><a href="/apps/search-api/search-api.html"><span>Using the search API</span></a></li>
            <li><a href="/apps/search-api/search-quality-metrics.html"><span>Search Quality Metrics</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/asset-manager.html"><span>asset-manager</span></a>
        <ul>
            <li><a href="/apps/asset-manager/api.html"><span>API</span></a></li>
            <li><a href="/apps/asset-manager/headers.html"><span>Headers</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/router-api.html"><span>router-api</span></a>
        <ul>
            <li><a href="/apps/router-api/api-endpoints.html"><span>API endpoints</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/support-api.html"><span>support-api</span></a>
    </li>
    <li>
      <a href="/apps/hmrc-manuals-api.html"><span>hmrc-manuals-api</span></a>
        <ul>
            <li><a href="/apps/hmrc-manuals-api/extended_documentation.html"><span>HMRC Manuals API - Extended Documentation</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/mapit.html"><span>mapit</span></a>
        <ul>
            <li><a href="/apps/mapit/about-datasets.html"><span>About datasets</span></a></li>
            <li><a href="/apps/mapit/api.html"><span>Example API output</span></a></li>
            <li><a href="/apps/mapit/importing-data.html"><span>MapIt - import postcode and boundary data</span></a></li>
            <li><a href="/apps/mapit/testing-server.html"><span>Testing a server with an updated Mapit database</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/cache-clearing-service.html"><span>cache-clearing-service</span></a>
    </li>
    <li>
      <a href="/apps/email-alert-service.html"><span>email-alert-service</span></a>
    </li>
    <li>
      <a href="/apps/search-analytics.html"><span>search-analytics</span></a>
    </li>
    <li>
      <a href="/apps/content-data-api.html"><span>content-data-api</span></a>
        <ul>
            <li><a href="/apps/content-data-api/data-warehouse-schema.html"><span>data-warehouse-schema</span></a></li>
            <li><a href="/apps/content-data-api/data-warehouse-what-and-why.html"><span>data-warehouse-what-and-why</span></a></li>
            <li><a href="/apps/content-data-api/etl-process.html"><span>Collecting user metrics</span></a></li>
            <li><a href="/apps/content-data-api/google_analytics_setup.html"><span>Set up Google Analytics credentials in development</span></a></li>
            <li><a href="/apps/content-data-api/how_to_handle_errors.html"><span>How to proceed with Sentry Errors</span></a></li>
            <li><a href="/apps/content-data-api/import_production_data.html"><span>Import Production Data</span></a></li>
            <li><a href="/apps/content-data-api/processing_publishing_api_messages.html"><span>Processing messages from the Publishing API</span></a></li>
            <li><a href="/apps/content-data-api/requeue_all_content.html"><span>Re-queue all content from the Publishing API</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/content-data-admin.html"><span>content-data-admin</span></a>
        <ul>
        </ul>
    </li>
    <li>
      <a href="/apps/search-admin.html"><span>search-admin</span></a>
        <ul>
        </ul>
    </li>
    <li>
      <a href="/apps/signon.html"><span>signon</span></a>
        <ul>
            <li><a href="/apps/signon/mass_password_reset.html"><span>mass_password_reset</span></a></li>
            <li><a href="/apps/signon/oauth.html"><span>Sign-On-O-Tron and OAuth2</span></a></li>
            <li><a href="/apps/signon/troubleshooting.html"><span>Troubleshooting</span></a></li>
            <li><a href="/apps/signon/usage.html"><span>Usage Documentation</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/support.html"><span>support</span></a>
    </li>
    <li>
      <a href="/apps/authenticating-proxy.html"><span>authenticating-proxy</span></a>
        <ul>
            <li><a href="/apps/authenticating-proxy/generating-a-token.html"><span>Generating an auth bypass token</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/release.html"><span>release</span></a>
        <ul>
            <li><a href="/apps/release/api.html"><span>Release API</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/router.html"><span>router</span></a>
    </li>
    <li>
      <a href="/apps/govuk-load-testing.html"><span>govuk-load-testing</span></a>
        <ul>
            <li><a href="/apps/govuk-load-testing/combining_concurrent_test_results.html"><span>Combining Concurrent Test Results</span></a></li>
            <li><a href="/apps/govuk-load-testing/uploading.html"><span>Uploading results</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/collections.html"><span>collections</span></a>
        <ul>
            <li><a href="/apps/collections/api.html"><span>Collections API</span></a></li>
            <li><a href="/apps/collections/update-covid-local-restriction-data.html"><span>Update COVID Local Restriction Data</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/email-alert-frontend.html"><span>email-alert-frontend</span></a>
        <ul>
            <li><a href="/apps/email-alert-frontend/tags-and-links.html"><span># Tags and links</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/feedback.html"><span>feedback</span></a>
        <ul>
            <li><a href="/apps/feedback/assisted_digital_feedback.html"><span>Assisted Digital Feedback</span></a></li>
            <li><a href="/apps/feedback/email_survey_signups.html"><span>Email Survey Signups</span></a></li>
            <li><a href="/apps/feedback/notify_template_parameters.html"><span>Notify template parameters</span></a></li>
            <li><a href="/apps/feedback/testing_with_real_authorisation.html"><span>Manual testing with real authorisation</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/finder-frontend.html"><span>finder-frontend</span></a>
        <ul>
            <li><a href="/apps/finder-frontend/analytics.html"><span>Analytics</span></a></li>
            <li><a href="/apps/finder-frontend/brexit-checker-content-changes.html"><span>Make changes to Transition Checker content</span></a></li>
            <li><a href="/apps/finder-frontend/brexit-checker.html"><span>Brexit Checker</span></a></li>
            <li><a href="/apps/finder-frontend/faceted-search.html"><span>faceted-search</span></a></li>
            <li><a href="/apps/finder-frontend/finder-content-item.html"><span>The Finder Content Item Format</span></a></li>
            <li><a href="/apps/finder-frontend/finder-email-alerts.html"><span>Finder email alerts</span></a></li>
            <li><a href="/apps/finder-frontend/how-search-works.html"><span>How search works</span></a></li>
            <li><a href="/apps/finder-frontend/pull_request_template.html"><span>pull_request_template</span></a></li>
            <li><a href="/apps/finder-frontend/registries.html"><span>Registries</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/frontend.html"><span>frontend</span></a>
    </li>
    <li>
      <a href="/apps/government-frontend.html"><span>government-frontend</span></a>
        <ul>
            <li><a href="/apps/government-frontend/webchat.html"><span>Webchat Component</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/info-frontend.html"><span>info-frontend</span></a>
    </li>
    <li>
      <a href="/apps/licence-finder.html"><span>licence-finder</span></a>
    </li>
    <li>
      <a href="/apps/manuals-frontend.html"><span>manuals-frontend</span></a>
    </li>
    <li>
      <a href="/apps/smart-answers.html"><span>smart-answers</span></a>
        <ul>
        </ul>
    </li>
    <li>
      <a href="/apps/service-manual-frontend.html"><span>service-manual-frontend</span></a>
    </li>
    <li>
      <a href="/apps/static.html"><span>static</span></a>
        <ul>
            <li><a href="/apps/static/analytics.html"><span>Analytics</span></a></li>
            <li><a href="/apps/static/emergency-banner.html"><span>Emergency banner</span></a></li>
            <li><a href="/apps/static/global-banner.html"><span># Global banner</span></a></li>
            <li><a href="/apps/static/humans.html"><span>humans.txt</span></a></li>
            <li><a href="/apps/static/image-optimisation.html"><span>Image optimisation</span></a></li>
            <li><a href="/apps/static/slimmer_templates.html"><span>Slimmer Templates</span></a></li>
            <li><a href="/apps/static/surveys.html"><span>Running test surveys on GOV.UK</span></a></li>
            <li><a href="/apps/static/test-ecommerce-changes-to-static.html"><span>test-ecommerce-changes-to-static</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/bouncer.html"><span>bouncer</span></a>
    </li>
    <li>
      <a href="/apps/transition.html"><span>transition</span></a>
    </li>
    <li>
      <a href="/apps/side-by-side-browser.html"><span>side-by-side-browser</span></a>
    </li>
    <li>
      <a href="/apps/datagovuk_find.html"><span>datagovuk_find</span></a>
    </li>
    <li>
      <a href="/apps/datagovuk_publish.html"><span>datagovuk_publish</span></a>
        <ul>
        </ul>
    </li>
    <li>
      <a href="/apps/ckanext-datagovuk.html"><span>ckanext-datagovuk</span></a>
        <ul>
            <li><a href="/apps/ckanext-datagovuk/migration_runsheet.html"><span>CKAN release rehearsal</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/datagovuk_reference.html"><span>datagovuk_reference</span></a>
    </li>
    <li>
      <a href="/apps/govuk-related-links-recommender.html"><span>govuk-related-links-recommender</span></a>
        <ul>
        </ul>
    </li>
    <li>
      <a href="/apps/seal.html"><span>seal</span></a>
    </li>
    <li>
      <a href="/apps/govuk-alert-tracker.html"><span>govuk-alert-tracker</span></a>
    </li>
    <li>
      <a href="/apps/govuk_app_config.html"><span>govuk_app_config</span></a>
        <ul>
            <li><a href="/apps/govuk_app_config/healthchecks.html"><span>Health Checks</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/govuk-content-store-examples.html"><span>govuk-content-store-examples</span></a>
        <ul>
            <li><a href="/apps/govuk-content-schemas/adding-a-new-schema.html"><span>Adding a new content schema</span></a></li>
            <li><a href="/apps/govuk-content-schemas/changing-a-schema.html"><span># How to change a content schema</span></a></li>
            <li><a href="/apps/govuk-content-schemas/contract-testing-howto.html"><span>Adding contract tests to your app</span></a></li>
            <li><a href="/apps/govuk-content-schemas/deployment.html"><span>Deployment</span></a></li>
            <li><a href="/apps/govuk-content-schemas/running-frontend-against-examples.html"><span>Running your frontend against the examples</span></a></li>
            <li><a href="/apps/govuk-content-schemas/suggested-workflows.html"><span>Suggested workflows for schema changes</span></a></li>
            <li><a href="/apps/govuk-content-schemas/why-contract-testing.html"><span>Why do contract testing?</span></a></li>
            <li><a href="/apps/govuk-content-schemas/working-with-json-schema-keywords.html"><span>Working with JSON Schema keywords</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/govuk-display-screen.html"><span>govuk-display-screen</span></a>
        <ul>
        </ul>
    </li>
    <li>
      <a href="/apps/govuk-dependencies.html"><span>govuk-dependencies</span></a>
    </li>
    <li>
      <a href="/apps/govuk-docker.html"><span>govuk-docker</span></a>
        <ul>
            <li><a href="/apps/govuk-docker/compatibility.html"><span>Compatibility</span></a></li>
            <li><a href="/apps/govuk-docker/how-tos.html"><span>How To's</span></a></li>
            <li><a href="/apps/govuk-docker/troubleshooting.html"><span>Troubleshooting</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/govuk-puppet.html"><span>govuk-puppet</span></a>
        <ul>
            <li><a href="/apps/govuk-puppet/README.html"><span>Docs</span></a></li>
            <li><a href="/apps/govuk-puppet/adding-a-new-app.html"><span>adding-a-new-app</span></a></li>
            <li><a href="/apps/govuk-puppet/dependency-management.html"><span>Dependency management</span></a></li>
            <li><a href="/apps/govuk-puppet/nagios-checks.html"><span>Nagios checks</span></a></li>
            <li><a href="/apps/govuk-puppet/process-supervision.html"><span>Process supervision</span></a></li>
            <li><a href="/apps/govuk-puppet/puppet-class-assigment.html"><span>Puppet Class Assignment</span></a></li>
            <li><a href="/apps/govuk-puppet/things-that-should-not-be-in-puppet.html"><span>Things that should not be in Puppet</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/govuk-zendesk-display-screen.html"><span>govuk-zendesk-display-screen</span></a>
        <ul>
        </ul>
    </li>
    <li>
      <a href="/apps/govuk-secondline-blinken.html"><span>govuk-secondline-blinken</span></a>
        <ul>
        </ul>
    </li>
    <li>
      <a href="/apps/side-by-side-browser.html"><span>side-by-side-browser</span></a>
    </li>
    <li>
      <a href="/apps/tech-docs-monitor.html"><span>tech-docs-monitor</span></a>
    </li>
    <li>
      <a href="/apps/govuk-pact-broker.html"><span>govuk-pact-broker</span></a>
    </li>
    <li>
      <a href="/apps/search-performance-explorer.html"><span>search-performance-explorer</span></a>
    </li>
    <li>
      <a href="/apps/specialist-frontend.html"><span>specialist-frontend</span></a>
        <ul>
        </ul>
    </li>
    <li>
      <a href="/apps/contacts-frontend.html"><span>contacts-frontend</span></a>
    </li>
    <li>
      <a href="/apps/multipage-frontend.html"><span>multipage-frontend</span></a>
        <ul>
            <li><a href="/apps/multipage-frontend/caching-strategies.html"><span>## Overview</span></a></li>
        </ul>
    </li>
    <li>
      <a href="/apps/design-principles.html"><span>design-principles</span></a>
    </li>
    <li>
      <a href="/apps/organisations-publisher.html"><span>organisations-publisher</span></a>
    </li>
    <li>
      <a href="/apps/panopticon.html"><span>panopticon</span></a>
        <ul>
        </ul>
    </li>
    <li>
      <a href="/apps/policy-publisher.html"><span>policy-publisher</span></a>
        <ul>
        </ul>
    </li>
    <li>
      <a href="/apps/business-support-api.html"><span>business-support-api</span></a>
    </li>
    <li>
      <a href="/apps/govuk-delivery.html"><span>govuk-delivery</span></a>
    </li>
    <li>
      <a href="/apps/govuk_content_api.html"><span>govuk_content_api</span></a>
    </li>
    <li>
      <a href="/apps/govuk_need_api.html"><span>govuk_need_api</span></a>
    </li>
    <li>
      <a href="/apps/metadata-api.html"><span>metadata-api</span></a>
    </li>
    <li>
      <a href="/apps/business-support-finder.html"><span>business-support-finder</span></a>
        <ul>
        </ul>
    </li>
    <li>
      <a href="/apps/calculators.html"><span>calculators</span></a>
    </li>
    <li>
      <a href="/apps/calendars.html"><span>calendars</span></a>
        <ul>
        </ul>
    </li>
  </ul>

              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              <div class="govuk-!-font-size-16 govuk-!-margin-top-6">
    <div class="govuk-warning-text">
      <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
      <strong class="govuk-warning-text__text">
        <span class="govuk-warning-text__assistive">Warning</span>
        This document has not been updated for a while now. It may be out of date.
      </strong>
    </div>

  Last updated: <a href="https://github.com/alphagov/search-api/commit/2675a59c7c82a1000f9ac0baf9fa3f97fc68fa26">9 Jun 2020</a>
</div>

  <h1 class="page-title">search-api: Relevancy</h1>

  
<p>This document explains how relevancy ordering works when performing a
search.</p>
<h2 id="contents">Contents</h2>
<ol>
<li><a href="#what-is-relevancy">What is relevancy?</a></li>
<li><a href="#what-impacts-relevancy">What impacts relevancy?</a></li>
<li>
<a href="#what-impacts-document-retrieval">What impacts document retrieval?</a>
<ol>
<li><a href="#boosting">Boosting</a></li>
<li><a href="#best-and-worst-bets">Best and worst bets</a></li>
<li><a href="#stopwords">Stopwords</a></li>
<li><a href="#synonyms">Synonyms</a></li>
<li><a href="#categorisation-of-fields">Categorisation of fields</a></li>
<li><a href="#analyzers">Analyzers</a></li>
<li><a href="#excluded-formats">Excluded formats</a></li>
</ol>
</li>
<li><a href="#possible-problems-with-queries-and-relevance">Possible problems with queries and relevance</a></li>
<li><a href="#finding-underperforming-queries">Finding underperforming queries</a></li>
</ol>
<h2 id="what-is-relevancy">What is relevancy?</h2>
<p>A list of documents returned by Search API will include an <code>es_score</code> and
a <code>combined_score</code> on every document.</p>
<pre lang="ruby"><code># Response for a search for 'Harry Potter'
[
  { title: "Harry Potter", combined_score: 3 },
  { title: "Harry Kane", combined_score: 2 },
  { title: "Ron Weasley", combined_score: 1 }
]
</code></pre>
<p>The <code>combined_score</code> is used for ranking results and represents how
relevant we think a result is to your query.</p>
<h2 id="what-impacts-relevancy">What impacts relevancy?</h2>
<p>Once Search API has <a href="#what-impacts-document-retrieval">retrieved</a> the
top scoring documents from the search indexes, it ranks the results
in order of relevance using a pre-trained model.</p>
<p>See the <a href="/apps/search-api/learning-to-rank.html">learning to rank</a> documentation for
more details.</p>
<h2 id="what-impacts-document-retrieval">What impacts document retrieval?</h2>
<p>Out of the box, Elasticsearch comes with a decent scoring algorithm.
They have a <a href="https://www.elastic.co/guide/en/elasticsearch/guide/master/scoring-theory.html">guide on scoring relevancy</a> which is worth
reading.</p>
<p>We've done some work in Search API to <a href="https://www.elastic.co/guide/en/elasticsearch/guide/master/relevance-conclusion.html">tune relevancy</a>,
overriding the default Elasticsearch behaviour, which we go into
below.</p>
<p>These following factors are combined into a single <code>es_score</code>. The
top scoring documents will be retrieved for ranking.</p>
<h3 id="boosting">Boosting</h3>
<p>We don't only use the query relevancy score to rank documents, we
apply some additional boosting factors:</p>
<ul>
<li>
<strong>Popularity:</strong> more visited documents are likely to be more useful
to users.</li>
<li>
<strong>Recency:</strong> a more recently updated document is more likely to be
useful than an older document.</li>
<li>
<strong>Properties:</strong> we have domain-specific knowledge about our
content, and can make judgements on what sorts of content are more
likely to be useful to the average user.</li>
</ul>
<h4 id="popularity">Popularity</h4>
<p>This is updated nightly from recent Google Analytics data, gathered by
the <a href="https://github.com/alphagov/search-analytics">search-analytics</a> application.</p>
<p>Here is the initial reasoning for the numbers (<a href="https://github.com/alphagov/search-api/commit/6cbd84f36ff70ce1be6a368e807c72ba09c74f23">6cbd84f</a>, May 2014):</p>
<blockquote>
<p>This field is populated from the page-traffic index, which in turn
is populated from a dump file produced by the python scripts in the
search-analytics repository.</p>
<p>The popularity is currently defined here as 1.0 / the rank of the
page in terms of traffic.  ie, Our highest traffic page gets 1.0,
the next highest gets 0.5, the next highest gets 0.333.  This is a
nice and stable measure.</p>
</blockquote>
<p>If we want to boost the popularity of a query then we do so by 0.001
(<code>POPULARITY_OFFSET = 0.001</code> in <a href="https://github.com/alphagov/search-api/blob/master/lib/search/query_components/popularity.rb">popularity.rb</a>).  It is not clear
where this number came from.</p>
<p>We also boost using <code>boost_mode: :multiply</code> (multiply the <code>_score</code>
with the function result (default)).</p>
<p>We store page traffic data in the <code>page-traffic</code> index.  For each page
we store its rank relative to other pages on GOV.UK in the <code>rank_14</code>
field and its number of page views in the <code>vc_14</code> field.</p>
<h4 id="recency">Recency</h4>
<p>This is an implementation of <a href="http://www.wolframalpha.com/share/clip?f=d41d8cd98f00b204e9800998ecf8427e5qr62u0si">this curve</a>, and is applied to
documents of the "announcement" type in the <a href="https://github.com/alphagov/search-api/blob/master/lib/search/query_components/booster.rb">booster.rb</a> file.  It
serves to increase the score of new documents and decrease the score
of old documents.</p>
<p>Only documents of <code>search_format_types</code> 'announcement' are affected by
recency boosting.</p>
<p>The curve came from the solr documentation, but the link to the
original source is broken, so it is unclear why this particular curve
was chosen.</p>
<h4 id="properties">Properties</h4>
<p>This is defined by the <a href="https://github.com/alphagov/search-api/blob/master/config/query/boosting.yml">boosting.yml</a> file, and is applied in the
<a href="https://github.com/alphagov/search-api/blob/master/lib/search/query_components/booster.rb">booster.rb</a> file.</p>
<p>For example, if a document has <code>is_historic: true</code> we downrank it, so
it's less likely to appear at the top of search results.</p>
<p>It is unclear where the numbers came from.</p>
<h3 id="best-and-worst-bets">Best and worst bets</h3>
<p>Some search queries have perfect answers.  For example, a search for
"HM Treasury" should have the HM Treasury organisation page as the top
result.</p>
<p>To handle these cases we have a concept called "best bets".</p>
<p>A "best bet" for a search query is a result that should be shoehorned
into the top of the results list for that query.  It's a way of
boosting that is a surefire route to having your document top the
results for a given query.</p>
<p>Best bets are managed with the <a href="https://github.com/alphagov/search-admin">Search Admin</a> application.</p>
<p>Example best bets:</p>
<pre><code>Algeria: /foreign-travel-advice/algeria
Citizenship: /becoming-a-british-citizen
</code></pre>
<p>There's also a concept called "worst bets".  These are useful if our
search results are so bad that we have to manually downrank a result
for a given query.  For example, "vehicle" shouldn't result in
"unicycle" being the top result.</p>
<p>Best and worst bets are implemented in the <a href="https://github.com/alphagov/search-api/blob/master/lib/search/query_components/best_bets.rb">best_bets.rb</a> file.</p>
<h3 id="stopwords">Stopwords</h3>
<p>Stopwords are words like "is", "and", "an", and "a".  They're words we
filter out when processing a search query, since they're so common
they're not useful.  They also enable Elasticsearch to maintain a
smaller index.</p>
<p>The stopwords themselves are provided by Elasticsearch.  There's
nothing in the Search API repo that looks at a list of omitted terms.
This is handled by the default <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-stop-tokenfilter.html">stop token filter</a>.</p>
<p><strong>History of stopwords</strong></p>
<p>There has been some talk of not including stopwords in the past
(<a href="https://github.com/alphagov/search-api/commit/0fe6e526c78e8b115371855a91d4b39ccb22098a">0fe6e52</a>, May 2015) during this time a <code>no_stop</code> method was
implemented that seems to prevent stopwords from being used.  Again this
seems to be served by Elasticsearch because it's not defined in Search
API.</p>
<p><strong>Potential improvements to stopwords</strong></p>
<p>Given that we're taking a stock list of stopwords from Elasticsearch,
we may be missing out on a chance to edit them in a way that might be
more useful for users. Looking into what words to omit / not omit might
be a useful tuning exercise.</p>
<p>A search with stopwords is different to a search without stopwords:</p>
<ul>
<li>
<p>If you search Search API for stopwords then you get literally
nothing: <a href="http://www.gov.uk/api/search.json?q=the+that+and+if">http://www.gov.uk/api/search.json?q=the+that+and+if</a></p>
</li>
<li>
<p>If you search for nothing then you get the some of the more
frequently clicked links: <a href="http://www.gov.uk/api/search.json?q=">http://www.gov.uk/api/search.json?q=</a></p>
</li>
</ul>
<h3 id="synonyms">Synonyms</h3>
<p>A synonym is a word or phrase that means exactly or nearly the same as
another word or phrase in the same language, for example shut is a
synonym of close.</p>
<p>We use synonyms to show relevant results related to "vehicle tax" regardless
of whether you searched for "car tax" or "auto tax".</p>
<p>Synonyms are defined in the <a href="https://github.com/alphagov/search-api/blob/master/config/schema/synonyms.yml">synonyms.yml</a> file and are applied to
the Elasticsearch index configuration in the <a href="https://github.com/alphagov/search-api/blob/master/lib/schema/schema_config.rb">schema_config.rb</a>
file.</p>
<h4 id="grouping-of-synonyms">Grouping of synonyms</h4>
<p>Each group of synonyms is written in the form:</p>
<pre><code>foo, bar, baz =&gt; bat, qux, quux
</code></pre>
<p>This means that each of the (comma separated) terms on the left of the
<code>=&gt;</code> map to each of the (comma separated) terms on the right.</p>
<p>For example:</p>
<pre><code>leap, hop =&gt; jump
</code></pre>
<p>means "a search for 'leap' or 'hop' should return documents with
'jump' in them.</p>
<p>And:</p>
<pre><code>run, speedwalk =&gt; sprint, gallop
</code></pre>
<p>means "a search for 'run' or 'speedwalk' should return documents with
'sprint' or 'gallop' in them."</p>
<p>It must be applied both at index time and at query time, to ensure that query
terms are mapped to the same single value that exists in the index.</p>
<h3 id="filtering">Filtering</h3>
<p>Additional configuration is defined in the <a href="https://github.com/alphagov/search-api/blob/master/config/schema/elasticsearch_schema.yml">elasticsearch_schema.yml</a> and
<a href="https://github.com/alphagov/search-api/blob/master/config/schema/stems.yml">stems.yml</a> files.  This configuration is merged with the JSON
configuration, and then passed to Elasticsearch directly.</p>
<p><a href="https://opensourceconnections.com/blog/2016/12/02/solr-elasticsearch-synonyms-better-patterns-keyphrases/">This blog post</a> suggests that as well as using
keywords, it can be useful to use "keepwords" to only filter the
phrases we want.</p>
<p>The post suggests to first generate <a href="https://www.elastic.co/blog/searching-with-shingles">shingles</a>, followed by synonyms,
followed by <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-keep-words-tokenfilter.html">keepwords</a>.</p>
<p>In other words: generate candidate keyphrases by shingling, expand
them with synonyms, then cull out any non-synonyms with keepwords.</p>
<h3 id="categorisation-of-fields">Categorisation of fields</h3>
<p>We use parts of a document differently when processing a search query.</p>
<p>We do some categorisation of document fields, to tell Elasticsearch what
we can use them for.</p>
<p>For example <code>date</code> is used for date fields which can be returned and used
for ordering, filtering and aggregating. This lets you filter e.g.
<code>filter_public_timestamp=from:2015-01-01</code>.</p>
<p>There are also fields like <code>acronym</code> which is categorised as a
<code>searchable_text</code> type that Elasticsearch looks at when you submit a keyword
search. So you can search for <code>MOD</code> and get a link to that organisation as
the top result.</p>
<p>These are configured in <a href="https://github.com/alphagov/search-api/blob/master/config/schema/field_types.json"><code>config/schema/field_types.json</code></a> and
<a href="https://github.com/alphagov/search-api/blob/master/config/schema/field_definitions.json"><code>config/schema/field_definitions.json</code></a>.</p>
<h3 id="analyzers">Analyzers</h3>
<p>We have a number of custom analyzers that can be invoked at index time or when querying.</p>
<p>From the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analyzer.html">Elasticsearch documentation</a> on analyzers:</p>
<blockquote>
<p>The values of analyzed string fields are passed through an analyzer
to convert the string into a stream of tokens or terms.  For
instance, the string "The quick Brown Foxes." may, depending on
which analyzer is used, be analyzed to the tokens: quick, brown,
fox.  These are the actual terms that are indexed for the field,
which makes it possible to search efficiently for individual words
within big blobs of text.</p>
</blockquote>
<p>This table describes what each of our analyzers do:</p>
<table>
<thead>
<tr>
<th>Analyzer</th>
<th>Used by main query</th>
<th>Details</th>
<th>Normalize quotes</th>
<th>Strip Quotes</th>
<th>Tokenize</th>
<th>Trim</th>
<th>Lowercase</th>
<th>Asciifolding</th>
<th>Old school synonyms</th>
<th>Remove stop words</th>
<th>Synonyms</th>
<th>Mark protwords (not stemmed)</th>
<th>Stemmer override</th>
<th>Porter2 stemmer</th>
<th>Shingles</th>
<th>ID codes analysis</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>default</code></td>
<td>✔</td>
<td>Main analyzer if synonyms are disabled</td>
<td>✔</td>
<td>✔</td>
<td>standard</td>
<td>✖</td>
<td>✔</td>
<td></td>
<td>✖</td>
<td>✔</td>
<td>None</td>
<td>None</td>
<td>✔</td>
<td>✔</td>
<td>✖</td>
<td>✖</td>
</tr>
<tr>
<td><code>searchable_text</code></td>
<td>✖</td>
<td>New weighting query uses this for all_searchable_text and FIELD.no_stop</td>
<td>✔</td>
<td>✔</td>
<td>standard</td>
<td>✖</td>
<td>✔</td>
<td></td>
<td>✖</td>
<td>✖</td>
<td>None</td>
<td>None</td>
<td>✔</td>
<td>✔</td>
<td>✖</td>
<td>✖</td>
</tr>
<tr>
<td><code>with_index_synonyms</code></td>
<td>✖</td>
<td>New weighting query uses this for FIELD.synonym</td>
<td>✔</td>
<td>✔</td>
<td>standard</td>
<td>✖</td>
<td>✔</td>
<td></td>
<td>✖</td>
<td>✖</td>
<td>Index synonym list</td>
<td>Synonyms</td>
<td>✔</td>
<td>✔</td>
<td>✖</td>
<td>✖</td>
</tr>
<tr>
<td><code>with_search_synonyms</code></td>
<td>✖</td>
<td>New weighting query uses this at search time</td>
<td>✔</td>
<td>✔</td>
<td>standard</td>
<td>✖</td>
<td>✔</td>
<td></td>
<td>✖</td>
<td>✖</td>
<td>Search synonym list</td>
<td>Synonyms</td>
<td>✔</td>
<td>✔</td>
<td>✖</td>
<td>✖</td>
</tr>
<tr>
<td><code>exact_match</code></td>
<td>✖</td>
<td>Used by best_bet_exact_match_text</td>
<td>✔</td>
<td>✖</td>
<td>standard</td>
<td>✔</td>
<td>✔</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
</tr>
<tr>
<td><code>best_bet_stemmed_match</code></td>
<td>✖</td>
<td>Used for triggering best bets</td>
<td>✔</td>
<td>✔</td>
<td>standard</td>
<td>✖</td>
<td>✔</td>
<td></td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✔</td>
<td>✔</td>
<td>✖</td>
<td>✖</td>
</tr>
<tr>
<td><code>spelling_analyzer</code></td>
<td>✖</td>
<td>Used in spelling_text field</td>
<td>✔</td>
<td>✔</td>
<td>standard</td>
<td>✖</td>
<td>✔</td>
<td></td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>shingle</td>
<td>✖</td>
</tr>
<tr>
<td><code>string_for_sorting</code></td>
<td>✖</td>
<td>Used for storing a sortable subfield</td>
<td>✔</td>
<td>✔</td>
<td>keyword</td>
<td>✔</td>
<td>✔</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
</tr>
</tbody>
</table>
<p>Analyzers are used for different purposes, as the table describes. All of the
analyzers above are used for some purpose.</p>
<p>The main analyzer used at the moment is called <code>with_search_synonyms</code>.
This is the same as the <code>default</code> analyzer, except it also uses synonyms.</p>
<pre lang="yaml"><code># The default analyzer
with_search_synonyms:
  type: custom
  tokenizer: standard
  filter: [standard, asciifolding, lowercase, search_synonym, stop, stemmer_override, stemmer_english]
  char_filter: [normalize_quotes, strip_quotes]
</code></pre>
<p>These are the steps, ignoring asciifolding, which have been added:</p>
<ol>
<li>Normalise and strip quotes</li>
</ol>
<p>The character filters ensure that words with curly apostrophes are normalised
and in some cases removed, for consistent behaviour when searching with
quotes.</p>
<pre lang="ruby"><code>  "It's A Small’s World" =&gt; ["it", "small", "world"],
  "H'lo ’Hallo" =&gt; ["h'lo", "h'lo hallo", "hallo"]
</code></pre>
<pre><code>normalize_quotes:
  type: "mapping"
  mappings:
     - "\u0091=&gt;\u0027"
     - "\u0092=&gt;\u0027"
     - "\u2018=&gt;\u0027"
     - "\u2019=&gt;\u0027"
     - "\uFF07=&gt;\u0027"

strip_quotes:
  type: "pattern_replace"
  pattern: "\'"
  replacement: ""
</code></pre>
<ol start="2">
<li>
<p>Split into tokens (tokenizer)</p>
<p>We use the default Elasticsearch tokeniser (<code>tokenizer: standard</code>).</p>
<p>The standard tokeniser uses the unicode text segmentation algorithm.
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-standard-tokenizer.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-standard-tokenizer.html</a></p>
</li>
<li>
<p>Lowercase everything (filter)</p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-lowercase-tokenfilter.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-lowercase-tokenfilter.html</a></p>
</li>
<li>
<p>Remove stopwords (filter)</p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-stop-tokenfilter.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-stop-tokenfilter.html</a></p>
<p>Removes words in the english stopword list</p>
</li>
<li>
<p>Apply our custom stemmer override to each token (filter)</p>
<p>Customises stemming using this list
<a href="https://github.com/alphagov/search-api/blob/master/config/schema/stems.yml">https://github.com/alphagov/search-api/blob/master/config/schema/stems.yml</a></p>
</li>
<li>
<p>Apply the english Stemmer to each token (filter)</p>
<p>The <a href="http://snowball.tartarus.org/algorithms/english/stemmer.html">Porter2 stemming algorithm</a> for english text, an improvement
to the Porter algorithm.
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-stemmer-tokenfilter.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-stemmer-tokenfilter.html</a></p>
</li>
</ol>
<h3 id="excluded-formats">Excluded formats</h3>
<p>There are some document formats that are not included in search results.
These include smart answers, calculators, licence finders.</p>
<p>We also exclude some paths, such as <code>/random</code>, <code>/homepage</code>, and <code>/humans.txt</code>.</p>
<p>These no-indexed paths and formats are defined in <a href="https://github.com/alphagov/search-api/blob/master/config/govuk_index/migrated_formats.yaml"><code>config/govuk_index/migrated_formats.yaml</code></a>.</p>
<h3 id="debugging-es_score">Debugging es_score</h3>
<p>If you want to understand why a result has a given <code>es_score</code>, you can
use the Elasticsearch <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-explain.html">Explain API</a>.  This is exposed by the
Search API.</p>
<p>Please note that <code>es_score</code> is just one feature used by the reranking
model; we don't rank results using <code>es_score</code> alone.</p>
<p>You can see the reasons behind an <code>es_score</code> by including the
<code>debug=explain</code> query parameter in your query.  This will add an
<code>_explanation</code> field to every result, similar to a SQL-like <code>EXPLAIN</code>.</p>
<p>For example, see the explanation produced by <a href="https://www.gov.uk/api/search.json?debug=explain&amp;q=harry%20potter">searching for "harry
potter"</a>.  This shows an example of stemming, where
"harry" becomes "harri".  This is due to the rule "replace suffix 'y'
or 'Y' by 'i' if preceded by a non-vowel which is not the first letter
of the word".  You can also see that text similarity scoring (<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules-similarity.html#bm25">BM25</a>
in Elasticsearch 6) works by considering both term frequency and
document frequency.</p>
<p>You can see the query Search API sends to Elasticsearch with the
<code>debug=show_query</code> parameter.  Debug parameters can be combined, like
<code>debug=show_query,explain</code>.  The debug output is verbose, so sometimes
restricting to only a handful of results, with <code>count=0</code> or <code>count=1</code>,
is useful.</p>
<h2 id="possible-problems-with-queries-and-relevance">Possible problems with queries and relevance</h2>
<h3 id="the-way-we-handle-longer-search-terms-is-broken">The way we handle longer search terms is broken</h3>
<p>We use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html">phrase queries</a> to take phrases into account in search queries.</p>
<p>We're not using the <em><a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/slop.html">slop</a></em> parameter, so the phrase component will
only work where the query uses the exact same phrasing. It's not clear
whether this would be useful, except maybe for names of services/forms/departments.</p>
<p>The <code>slop</code> parameter tells the <code>match_phrase</code> query how far apart terms are
allowed to be while still considering the document a match. By <em>how far
apart</em> we mean <em>how many times do you need to move a term in order to make
the query and document match?</em></p>
<p>Explanation from the Lucene documentation:</p>
<blockquote>
<p>Sets the number of other words permitted between words in query phrase.
If zero, then this is an exact phrase search.</p>
</blockquote>
<blockquote>
<p>The slop is in fact an edit-distance, where the units correspond to moves
of terms in the query phrase out of position. For example, to switch the
order of two words requires two moves (the first move places the words
atop one another), so to permit re-orderings of phrases, the slop must
be at least two.</p>
</blockquote>
<blockquote>
<p>More exact matches are scored higher than sloppier matches, thus
search results are sorted by exactness.</p>
</blockquote>
<p>Essentially, with a <code>slop</code> value of 1, a query for 'harry potter' would
return documents with the phrase 'potter harry' in them.</p>
<p>Although all words need to be present in phrase matching, even when using
slop, the words don’t necessarily need to be in the same sequence in order
to match. With a high enough slop value, words can be arranged in any order.</p>
<p><a href="https://www.elastic.co/blog/searching-with-shingles">Shingles</a> are another way to take phrases into account,
which allow matching n-grams.  This was implemented in the past, but
was broken (<a href="https://github.com/alphagov/search-api/commit/6ece793190932fee31be5437c4c56773dc358ff6">6ece793</a>, May 2015) and the fixed implementation never
went live (<a href="https://github.com/alphagov/search-api/commit/806a68cb11f926c328bf360171c754ed6fca06ac">806a68c</a>, Dec 2017).</p>
<h3 id="there-is-no-boosting-of-individual-field-matches">There is no boosting of individual field matches</h3>
<p>We treat a match in title, description, acronym and indexable content
the same, but these are different things.  A user might expect title
and description matches to be much more important than body content.</p>
<p>We're using field-specific boosts (applied in the <a href="https://github.com/alphagov/search-api/blob/master/lib/search/query_components/core_query.rb">core_query.rb</a>
file) when the query is a quoted phrase, but not for normal searches.</p>
<pre lang="ruby"><code>PHRASE_MATCH_TITLE_BOOST = 5
PHRASE_MATCH_ACRONYM_BOOST = 5
PHRASE_MATCH_DESCRIPTION_BOOST = 2
PHRASE_MATCH_INDEXABLE_CONTENT_BOOST = 1
</code></pre>
<h3 id="popularity-is-the-main-proxy-for-good">Popularity is the main proxy for "good"</h3>
<p>Popularity is one of the biggest factors influencing the weighting.
It's based on the overall page views, so there's a positive feedback
loop where something gets popular, which makes it more visible, which
makes it even more popular.</p>
<p>In the past this has caused problems when we know content is better
but something else still gets high traffic (<a href="https://github.com/alphagov/search-api/commit/03c4bfa0a1a816a57d38b71ac5cb22c3a107c275">03c4bfa</a>, May 2015).</p>
<p>If we had other signals of content quality we might be able to reduce our
dependence on the page views.</p>
<h3 id="finding-underperforming-queries">Finding underperforming queries</h3>
<ol>
<li>Go to the <a href="https://datastudio.google.com/u/0/reporting/1-QjJDH5YkBWhF9qb-WEOuGuGIgNJExds/page/Zaus">datastudio report</a>
</li>
</ol>
<p>The report does not automatically update, so it will display only the data for the dates displayed.</p>
<p>To get new data, rerun the BigQuery queries.</p>
<ol start="2">
<li>Apply the following filters:</li>
</ol>
<ul>
<li><code>click_count &gt;= 100</code></li>
<li><code>median_position &gt;=4</code></li>
</ul>
<p>Underperforming queries are ones with a significant click count and a highish median, i.e. around 4 and above.</p>
<p><img src="https://raw.githubusercontent.com/alphagov/search-api/master/docs/images/datastudio-dash.png" alt="datastudio"></p>
<ol start="3">
<li>Visit the Google Analytics dashboard an underperforming query</li>
</ol>
<p>Once you have identified an underperforming query, head over to the Google Analytics (GA) dashboard to see the clickthrough rates and positions of the search results for that query.</p>
<p>e.g. <a href="https://analytics.google.com/analytics/web/#/report/conversions-ecommerce-product-list-performance/a26179049w50705554p53872948/_u.date00=20191016&amp;_u.date01=20191023&amp;explorer-table.plotKeys=%5B%5D&amp;explorer-table.rowCount=50&amp;explorer-table.secSegmentId=analytics.customDimension71&amp;explorer-table.advFilter=%5B%5B0,%22analytics.productListPosition%22,%22RE%22,%22%5E%5B0-9%5D%7B1,1%7D%24%22,0%5D,%5B0,%22analytics.customDimension71%22,%22EQ%22,%22utr%22,0%5D%5D&amp;_r.drilldown=analytics.productListName:Search&amp;explorer-table-dataTable.sortColumnName=analytics.productListCTR&amp;explorer-table-dataTable.sortDescending=true&amp;explorer-segmentExplorer.segmentId=analytics.productListPosition/">GA dashboard</a> for the term "utr".</p>
<p>Use the clickthrough rate of each search result relative to its position to inform your hypotheses.</p>


            
          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/search-api/blob/main/docs/relevancy.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?labels=bug&amp;title=Re:%20''&amp;body=Problem%20with%20''%20(https://docs.publishing.service.gov.uk/apps/search-api/relevancy.html)">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/accessibility.html">Accessibility</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
