
<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>email-alert-api: Decision Record: Initial architecture for Notify integration - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/apps/email-alert-api/adr/adr-001-notify-integration.html">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta name="twitter:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="email-alert-api: Decision Record: Initial architecture for Notify integration - GOV.UK Developer Documentation" />
      <meta name="twitter:url" content="https://docs.publishing.service.gov.uk/apps/email-alert-api/adr/adr-001-notify-integration.html" />

      <meta property="og:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="email-alert-api: Decision Record: Initial architecture for Notify integration" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/apps/email-alert-api/adr/adr-001-notify-integration.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/apps.html">Apps</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents" role="dialog">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search" aria-hidden="true">
      Search (via Google)
    </label>
    <input
      type="text"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="assertive" role="alert">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <ul>
    <li>
      <a href="/apps/by-team.html">
        <span>Application ownership by team</span>
      </a>
    </li>

      <li>
        <a href="/apps.html">
          <span>APIs</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/account-api.html"><span>account-api</span></a></li>
          <li><a href="/apps/asset-manager.html"><span>asset-manager</span></a></li>
          <li><a href="/apps/content-store.html"><span>content-store</span></a></li>
          <li><a href="/apps/email-alert-api.html"><span>email-alert-api</span></a></li>
          <li><a href="/apps/hmrc-manuals-api.html"><span>hmrc-manuals-api</span></a></li>
          <li><a href="/apps/imminence.html"><span>imminence</span></a></li>
          <li><a href="/apps/link-checker-api.html"><span>link-checker-api</span></a></li>
          <li><a href="/apps/mapit.html"><span>mapit</span></a></li>
          <li><a href="/apps/publishing-api.html"><span>publishing-api</span></a></li>
          <li><a href="/apps/router-api.html"><span>router-api</span></a></li>
          <li><a href="/apps/search-api.html"><span>search-api</span></a></li>
          <li><a href="/apps/support-api.html"><span>support-api</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Supporting apps</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/authenticating-proxy.html"><span>authenticating-proxy</span></a></li>
          <li><a href="/apps/content-data-admin.html"><span>content-data-admin</span></a></li>
          <li><a href="/apps/content-data-api.html"><span>content-data-api</span></a></li>
          <li><a href="/apps/govuk-load-testing.html"><span>govuk-load-testing</span></a></li>
          <li><a href="/apps/release.html"><span>release</span></a></li>
          <li><a href="/apps/router.html"><span>router</span></a></li>
          <li><a href="/apps/search-admin.html"><span>search-admin</span></a></li>
          <li><a href="/apps/signon.html"><span>signon</span></a></li>
          <li><a href="/apps/support.html"><span>support</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Transition apps</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/bouncer.html"><span>bouncer</span></a></li>
          <li><a href="/apps/side-by-side-browser.html"><span>side-by-side-browser</span></a></li>
          <li><a href="/apps/transition.html"><span>transition</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Services</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/cache-clearing-service.html"><span>cache-clearing-service</span></a></li>
          <li><a href="/apps/email-alert-service.html"><span>email-alert-service</span></a></li>
          <li><a href="/apps/search-analytics.html"><span>search-analytics</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>data.gov.uk apps</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/ckanext-datagovuk.html"><span>ckanext-datagovuk</span></a></li>
          <li><a href="/apps/datagovuk_find.html"><span>datagovuk_find</span></a></li>
          <li><a href="/apps/datagovuk_publish.html"><span>datagovuk_publish</span></a></li>
          <li><a href="/apps/datagovuk_reference.html"><span>datagovuk_reference</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Frontend apps</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/collections.html"><span>collections</span></a></li>
          <li><a href="/apps/email-alert-frontend.html"><span>email-alert-frontend</span></a></li>
          <li><a href="/apps/feedback.html"><span>feedback</span></a></li>
          <li><a href="/apps/finder-frontend.html"><span>finder-frontend</span></a></li>
          <li><a href="/apps/frontend.html"><span>frontend</span></a></li>
          <li><a href="/apps/government-frontend.html"><span>government-frontend</span></a></li>
          <li><a href="/apps/info-frontend.html"><span>info-frontend</span></a></li>
          <li><a href="/apps/licence-finder.html"><span>licence-finder</span></a></li>
          <li><a href="/apps/manuals-frontend.html"><span>manuals-frontend</span></a></li>
          <li><a href="/apps/service-manual-frontend.html"><span>service-manual-frontend</span></a></li>
          <li><a href="/apps/smart-answers.html"><span>smart-answers</span></a></li>
          <li><a href="/apps/static.html"><span>static</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Publishing apps</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/collections-publisher.html"><span>collections-publisher</span></a></li>
          <li><a href="/apps/contacts-admin.html"><span>contacts-admin</span></a></li>
          <li><a href="/apps/content-publisher.html"><span>content-publisher</span></a></li>
          <li><a href="/apps/content-tagger.html"><span>content-tagger</span></a></li>
          <li><a href="/apps/local-links-manager.html"><span>local-links-manager</span></a></li>
          <li><a href="/apps/manuals-publisher.html"><span>manuals-publisher</span></a></li>
          <li><a href="/apps/maslow.html"><span>maslow</span></a></li>
          <li><a href="/apps/publisher.html"><span>publisher</span></a></li>
          <li><a href="/apps/service-manual-publisher.html"><span>service-manual-publisher</span></a></li>
          <li><a href="/apps/short-url-manager.html"><span>short-url-manager</span></a></li>
          <li><a href="/apps/specialist-publisher.html"><span>specialist-publisher</span></a></li>
          <li><a href="/apps/travel-advice-publisher.html"><span>travel-advice-publisher</span></a></li>
          <li><a href="/apps/whitehall.html"><span>whitehall</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Utilities</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/gds-api-adapters.html"><span>gds-api-adapters</span></a></li>
          <li><a href="/apps/govuk-content-store-examples.html"><span>govuk-content-store-examples</span></a></li>
          <li><a href="/apps/govuk-dependencies.html"><span>govuk-dependencies</span></a></li>
          <li><a href="/apps/govuk-display-screen.html"><span>govuk-display-screen</span></a></li>
          <li><a href="/apps/govuk-docker.html"><span>govuk-docker</span></a></li>
          <li><a href="/apps/govuk-jenkinslib.html"><span>govuk-jenkinslib</span></a></li>
          <li><a href="/apps/govuk-pact-broker.html"><span>govuk-pact-broker</span></a></li>
          <li><a href="/apps/govuk-puppet.html"><span>govuk-puppet</span></a></li>
          <li><a href="/apps/govuk-secondline-blinken.html"><span>govuk-secondline-blinken</span></a></li>
          <li><a href="/apps/govuk-zendesk-display-screen.html"><span>govuk-zendesk-display-screen</span></a></li>
          <li><a href="/apps/govuk_app_config.html"><span>govuk_app_config</span></a></li>
          <li><a href="/apps/seal.html"><span>seal</span></a></li>
          <li><a href="/apps/search-performance-explorer.html"><span>search-performance-explorer</span></a></li>
          <li><a href="/apps/slimmer.html"><span>slimmer</span></a></li>
          <li><a href="/apps/special-route-publisher.html"><span>special-route-publisher</span></a></li>
          <li><a href="/apps/tech-docs-monitor.html"><span>tech-docs-monitor</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>GOV.UK Account</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/govuk-account-manager-prototype.html"><span>govuk-account-manager-prototype</span></a></li>
          <li><a href="/apps/govuk-attribute-service-prototype.html"><span>govuk-attribute-service-prototype</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Data science</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/govuk-knowledge-graph.html"><span>govuk-knowledge-graph</span></a></li>
          <li><a href="/apps/govuk-related-links-recommender.html"><span>govuk-related-links-recommender</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Licensing apps</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/licensify.html"><span>licensify</span></a></li>
          <li><a href="/apps/licensify-admin.html"><span>licensify-admin</span></a></li>
          <li><a href="/apps/licensify-feed.html"><span>licensify-feed</span></a></li>
        </ul>
      </li>
  </ul>

              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              
<script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "name": "Home",
        "@id": "http://www.dev.gov.uk/"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "name": "Apps",
        "@id": "http://www.dev.gov.uk/apps.html"
      }
    },
    {
      "@type": "ListItem",
      "position": 3,
      "item": {
        "name": "email-alert-api",
        "@id": "http://www.dev.gov.uk/apps/email-alert-api.html"
      }
    }
  ]
}
</script>

<div class="gem-c-breadcrumbs govuk-breadcrumbs" data-module="gem-track-click">
  <ol class="govuk-breadcrumbs__list">
        <li class="govuk-breadcrumbs__list-item">
          <a data-track-category="homeLinkClicked" data-track-action="homeBreadcrumb" data-track-label="" data-track-options="{}" class="govuk-breadcrumbs__link" href="/">Home</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
          <a data-track-category="breadcrumbClicked" data-track-action="2" data-track-label="/apps.html" data-track-options="{&quot;dimension28&quot;:&quot;3&quot;,&quot;dimension29&quot;:&quot;Apps&quot;}" class="govuk-breadcrumbs__link" href="/apps.html">Apps</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
          <a data-track-category="breadcrumbClicked" data-track-action="3" data-track-label="/apps/email-alert-api.html" data-track-options="{&quot;dimension28&quot;:&quot;3&quot;,&quot;dimension29&quot;:&quot;email-alert-api&quot;}" class="govuk-breadcrumbs__link" href="/apps/email-alert-api.html">email-alert-api</a>
        </li>
  </ol>
</div>

  <div class="govuk-!-font-size-16 govuk-!-margin-top-6">
    <div class="govuk-warning-text">
      <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
      <strong class="govuk-warning-text__text">
        <span class="govuk-warning-text__assistive">Warning</span>
        This document has not been updated for a while now. It may be out of date.
      </strong>
    </div>

  Last updated: <a href="https://github.com/alphagov/email-alert-api/commit/f093ec099e5c7131e99fdc6750c9802eba643527">7 Oct 2020</a>
</div>

  <h1 class="page-title">email-alert-api: Decision Record: Initial architecture for Notify integration</h1>

  
<h2 id="introduction">Introduction</h2>
<p>In October 2017 we, the GOV.UK Email team, began a project where we are
intending to expand the responsibilities of email-alert-api application to
handle creating and sending of alerts that enter the system. The changed system
intends to use <a href="https://www.notifications.service.gov.uk/">Notify</a> as the transportation layer to send emails.</p>
<p>As part of considering this we have conducted a piece of work to outline the
architecture for the application which this document presents.</p>
<h3 id="how-we-are-treating-digests">How we are treating digests</h3>
<p>At the time of putting this together it was unclear exactly what the product
decisions and functionality would be regarding digests, however we did want
them to be considered in the architecture. For clarity this explains our best
guess understanding of how digests will work prior to appropriate product
decisions.</p>
<ul>
<li>Digests are expected to continue current behaviour of merging multiple
subscriptions into a single email.</li>
<li>It is not essential that digests return the same content for each user with
same subscriptions. E.g. a digest processed for Joe processed 2 mins after
Steve may get slightly different results if something was published in that
time.</li>
<li>If you are subscribed to things that produce the same content for two
subscriptions at different digest frequencies, you will only receive
notifications for a piece of content once (on the higher frequency).</li>
<li>Digests take effect from the point of subscription. E.g. if you joined a
weekly digest on a Wednesday that was sent on Fridays you’d only get alerts
for content after you joined We can send remaining digest emails out when
someone changes subscription preferences.</li>
</ul>
<h2 id="specifics">Specifics</h2>
<p>The architecture can be visualised through two diagrams:</p>
<ol>
<li>
<a href="https://github.com/alphagov/email-alert-api/blob/main/docs/domain.png">Domain model</a> which represents the data models and how they
relate</li>
<li>
<a href="https://github.com/alphagov/email-alert-api/blob/main/docs/sequence_diagram.png">Sequence diagram</a> which represents all of the
components and how they communicate to achieve specified functionality</li>
</ol>
<p>This document then goes through each of the concepts in the diagram and
outlines their roles and responsibilities.</p>
<h3 id="contentchange">ContentChange</h3>
<p><strong>Responsibility</strong>: Representing a piece of content that is either new or has
changed and should produce an alert.</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Store information such as:
<ul>
<li>Title of content</li>
<li>Description of content</li>
<li>Change note (if any) associated with the update</li>
<li>Path to content</li>
</ul>
</li>
</ul>
<h4 id="should">Should</h4>
<ul>
<li>Store information about what subscription criteria it matches (links, tags,
supertypes)</li>
<li>Have fields required for auditing
<ul>
<li>Where the request came from</li>
<li>Be able to determine whether and when it has been processed by a worker
(processed_at presence)</li>
</ul>
</li>
<li>Be persisted forever</li>
</ul>
<h4 id="may">May</h4>
<ul>
<li>In future, have an association to an entity that models the subscription
criteria information (links, tags, super types)</li>
<li>Be considered as part of an Alert supertype which may represent other types
of alerts in the system</li>
</ul>
<h3 id="subscriber-list">Subscriber List</h3>
<p><strong>Responsibility</strong>: Being a type of list that a user can subscribe to and storing
information specific to that list.</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Store information such as
<ul>
<li>List name</li>
</ul>
</li>
</ul>
<h4 id="should">Should</h4>
<ul>
<li>Require that the list name is unique, as we don't know how to differentiate
identically named lists to users yet</li>
<li>Temporarily maintain a relationship with corresponding govdelivery list</li>
<li>Store information about what subscription criteria it matches
(links, tags, document_supertypes)</li>
<li>Have information to source where the Subscriber List originated from</li>
</ul>
<h4 id="may">May</h4>
<ul>
<li>In future, have an association to an entity that models the subscription
criteria information (links, tags, super types)</li>
<li>Release the requirement of a list name being unique if we are able to
establish a way to differentiate between lists</li>
<li>Store statistics related to the list</li>
<li>Be stored even after it is removed - for logging purposes, dependent on if
this will impact unique constraints</li>
</ul>
<h4 id="to-determine">To determine</h4>
<ul>
<li>In what scenarios is a Subscriber List removed</li>
</ul>
<h3 id="subscriber">Subscriber</h3>
<p><strong>Responsibility</strong>: Represent an individual user that can subscribe to content,
stores information related to all subscriptions the user may have</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Store information such as
<ul>
<li>Email Address</li>
</ul>
</li>
<li>Support an email address changing</li>
</ul>
<h4 id="should">Should</h4>
<ul>
<li>Be deleteable, a user may wish to remove their account - this should not
break history of emails sent</li>
<li>Be used in the future for authentication purposes</li>
</ul>
<h4 id="may">May</h4>
<ul>
<li>Store preferences that affect all of a users subscriptions</li>
<li>Have the ability to be disabled if there are problems with a users account</li>
<li>Store other personalisation information such as name</li>
<li>Be associated with statistics regarding the subscriber</li>
</ul>
<h4 id="to-determine">To determine</h4>
<ul>
<li>What should we allow in terms of removing a subscriber - do we use the
associated data as a log?</li>
</ul>
<h3 id="subscription">Subscription</h3>
<p><strong>Responsibility</strong>: Store that a Subscriber has an association to a Subscriber
List and any associated data (e.g. preferences)</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Store an association to a Subscriber</li>
<li>Store an association to a Subscriber List</li>
</ul>
<h4 id="should">Should</h4>
<ul>
<li>Be used to store preferences associated with a particular subscription</li>
</ul>
<h4 id="should-not">Should Not</h4>
<ul>
<li>Be removed from the system when a user unsubscribes from a Subscriber List as
this provides a log that a user has been subscribed with the associated
content and maintaining the record allows us to restore preferences if
subscription is resumed</li>
</ul>
<h4 id="may">May</h4>
<ul>
<li>Be used to store statistics on a subscribers activity relating to that
subscription</li>
<li>In future be something that can be paused</li>
</ul>
<h4 id="to-determine">To determine</h4>
<ul>
<li>What should happen if either Subscriber List or Subscriber are removed/archived</li>
</ul>
<h3 id="subscriptioncontent">SubscriptionContent</h3>
<p><strong>Responsibility</strong>: Represent that a content change should or has been emailed to a
subscription</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Have an association with a ContentChange</li>
<li>Have an association with a Subscription</li>
<li>Have a nullable association with Email</li>
<li>Know whether it has been processed</li>
</ul>
<h4 id="should">Should</h4>
<ul>
<li>Allow for multiple subscriptions associated with the same Subscriber to be
associated with the same ContentChange - It is the EmailGeneration
responsibility to consolidate these</li>
<li>Allow for multiple entries with same ContentChange and Subscription - to
allow a content change to be reprocessed in the event of an error</li>
<li>Support Email records being removed from the system for auditing process</li>
<li>Be deleteable for a scenario that a user changes a subscription before an
email is sent</li>
</ul>
<h4 id="to-determine">To determine</h4>
<ul>
<li>What is the archiving strategy on these? Will they be persisted forever or
match persistence strategy of Emails for instance?</li>
</ul>
<h3 id="email">Email</h3>
<p><strong>Responsibility</strong>: A distinct email that the system will be sending or has sent</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Be created any time Email Alert API sends an email</li>
<li>Store information such as
<ul>
<li>Recipient</li>
<li>Subject</li>
<li>Body (in Notify Markdown)</li>
</ul>
</li>
<li>Delivery status</li>
</ul>
<h4 id="shall-not">Shall Not</h4>
<ul>
<li>Have more than one recipient</li>
<li>Know anything about the content that led to its generation</li>
</ul>
<h4 id="should">Should</h4>
<ul>
<li>Only exist in the database for a non permanent time period</li>
<li>Be associated with a Subscriber for logging purposes</li>
</ul>
<h4 id="may">May</h4>
<ul>
<li>Be archived into a log somewhere for later analysis</li>
</ul>
<h3 id="deliveryattempt">DeliveryAttempt</h3>
<p><strong>Responsibility</strong>: Storing the information used to communicate with the
transportation service for email</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Store information such as
<ul>
<li>Email associated with</li>
<li>Provider (e.g. Notify)</li>
<li>Provider Reference (An id to look up the email)</li>
<li>Status (success/pending/failure)</li>
</ul>
</li>
<li>Any provider specific errors/warnings</li>
</ul>
<h4 id="should">Should</h4>
<ul>
<li>Be created whenever an email is attempted to be sent</li>
<li>Be updated when sufficient information is known about whether an email has
sent or not</li>
<li>Be deleted when an Email is deleted</li>
</ul>
<h4 id="may">May</h4>
<ul>
<li>Be created in a success state if it was known the delivery attempt was
successful synchronously</li>
<li>Be used in future with different transport mechanisms if we expand beyond
Email</li>
</ul>
<h3 id="contentchangecontroller">ContentChangeController</h3>
<p><strong>Responsibility</strong>: Storing a ContentChange, enquing that for processing,
returning a success</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Create a ContentChange model</li>
<li>Enqueue a SubscriptionContentWorker job</li>
</ul>
<h4 id="to-determine">To determine</h4>
<ul>
<li>Who has responsibility for the Worker failing to run?</li>
</ul>
<h3 id="subscriptioncontentworker">SubscriptionContentWorker</h3>
<p><strong>Responsibility</strong>: Responsible for determining which subscriptions should receive
an email prospectively and creating SubscriptionContent objects accordingly</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Be given sufficient input to lookup a ContentChange</li>
<li>Liaise with SubscriptionMatcher to determine all subscriptions that match a
ContentChange</li>
<li>Create SubscriptionContent entities for all subscriptions that match a
ContentChange</li>
<li>Trigger EmailGenerationWorker for emails that have to run immediately</li>
</ul>
<h4 id="should-not">Should not</h4>
<ul>
<li>Be able to have multiple instances of this worker processing the same
ContentChange concurrently</li>
</ul>
<h4 id="may">May</h4>
<ul>
<li>Accept frequency as an argument to match subscriptions for that frequency in
order to allow rebuilding of emails that went out in error</li>
</ul>
<h3 id="subscriptionmatcher">SubscriptionMatcher</h3>
<p><strong>Responsibility</strong>: When given a certain criteria determine which Subscription
objects are associated with it</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Accept ContentChange object as input</li>
<li>From input determine which Subscription objects match</li>
<li>Will use existing logic in SubscriberListQuery</li>
</ul>
<h4 id="to-determine">To determine</h4>
<ul>
<li>Should we be considering how this might scale for a huge number of
subscriptions?</li>
</ul>
<h3 id="emailgenerationworker">EmailGenerationWorker</h3>
<p><strong>Responsibility</strong>: Responsible for finding Subscription objects that should be
sent at a given frequency and producing Email objects that can be sent</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Find SubscriptionContent entities that match that frequency and have not been
processed</li>
<li>Take one or more SubscriptionContent entries for a user and create a
corresponding Email entity</li>
<li>Update SubscriptionContent entries to associate them with an email and
indicate they are processed</li>
<li>Liaise with EmailRenderer to convert one or more SubscriptionContent entities
into the subject and body for an Email</li>
</ul>
<h4 id="should">Should</h4>
<ul>
<li>Take input of a frequency (immediate, weekly, daily)</li>
<li>Be able to consolidate SubscriptionContent entries that refer to the same
ContentChange</li>
</ul>
<h4 id="should-not">Should not</h4>
<ul>
<li>Be able to process the same SubscriptionContent objects in multiple
concurrent processes</li>
</ul>
<h4 id="may">May</h4>
<ul>
<li>Have its interface reconsidered to allow for increased ability to build
emails in parallel</li>
</ul>
<h4 id="to-determine">To determine</h4>
<ul>
<li>If a user has multiple subscriptions which are at different frequencies, is
this the class that will consolidate them?</li>
</ul>
<h3 id="digesttimer">DigestTimer</h3>
<p><strong>Responsibility</strong>: Triggering EmailBuilderWorker to run at a given frequency</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Trigger EmailGenerationWorker to run at daily intervals</li>
<li>Trigger EmailGenerationWorker to run at weekly intervals</li>
</ul>
<h4 id="to-determine">To determine</h4>
<ul>
<li>When these intervals are</li>
<li>What mechanisms would be in place to handle this failing to occur</li>
</ul>
<h3 id="emailrenderer">EmailRenderer</h3>
<p><strong>Responsibility</strong>: Converting one or more Email Entries into a Notify Markdown
formatted text</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Take input of one or more SubscriptionContent entities and a frequency</li>
<li>Generate a subject in plain text</li>
<li>Generate a body in Notify Markdown</li>
</ul>
<h4 id="should">Should</h4>
<ul>
<li>Be able to generate differently formatted emails for weekly and daily emails</li>
</ul>
<h4 id="may">May</h4>
<ul>
<li>Have sufficient information to include unsubscribe links in emails</li>
</ul>
<h3 id="emaildeliveryworker">EmailDeliveryWorker</h3>
<p><strong>Responsibility</strong>: Finding Emails that should be sent and creating
DeliveryAttempts for them and updating Email status accordingly</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Communicate with a transportation layer (Notify) to send an Email</li>
<li>Create a DeliveryAttempt object to associate with the Email</li>
<li>Update the Email and DeliveryAttempt objects based on the outcome of the
request</li>
</ul>
<h4 id="should">Should</h4>
<ul>
<li>Be able to retry requests to Notify that fail and are retryable (e.g.
temporary network outage)</li>
<li>Be able to abort trying to send an email if it’s a situation where retrying
won't result in a success (e.g. 400 bad request)</li>
</ul>
<h4 id="may">May</h4>
<ul>
<li>React to the transportation layer returning a 429 status code</li>
</ul>
<h4 id="to-determine">To determine</h4>
<ul>
<li>What should happen when an email has exhausted retries</li>
<li>What should happen when an email fails due to a bad request</li>
</ul>
<h3 id="deliverymonitor">DeliveryMonitor</h3>
<p><strong>Responsibility</strong>: Determining whether Notify was able to send emails we have
tried to send or not</p>
<h4 id="shall">Shall</h4>
<ul>
<li>Communicate with a transportation layer (Notify) to determine if a pending
delivery attempt is still in progress, successful or a failure</li>
<li>Update the Email and DeliveryAttempt objects based on the outcome of the
request</li>
</ul>
<h4 id="should">Should</h4>
<ul>
<li>Be able to abort attempting to send an email if Notify returns a temporary
failure for that email address</li>
<li>Be able to remove/suspend a users account if Notify returns a permanent
failure for the corresponding email address</li>
<li>Be able to retry sending an email if Notify returns a notify failure error
which indicates a sending can be retried</li>
</ul>
<h4 id="to-determine">To determine</h4>
<ul>
<li>Which system (if any) and what rules and behaviour it will follow for
removing/suspending accounts that receive permanent failure messages from
Notify</li>
</ul>


            
          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/email-alert-api/blob/main/docs/adr/adr-001-notify-integration.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?labels=bug&amp;title=Re:%20''&amp;body=Problem%20with%20''%20(https://docs.publishing.service.gov.uk/apps/email-alert-api/adr/adr-001-notify-integration.html)">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/accessibility.html">Accessibility</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
